<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="https://npmcdn.com/basscss@7.1.1/css/basscss.min.css">
    <title>automata, take 1</title>
    <meta name="description" content="">
    <meta name="author" content="Brian Zelip">
    <meta name="keywords" content="">
    <style>

      #automata { margin: 3.5px 2.5px; }

      .row { line-height: 1; }

      .cell {
        height: 25px;
        width: 25px;
        display: inline-block;
        /*border-radius: 50%;*/
        margin: 3.5px 5px;
        box-sizing: border-box;
      }

      .active { background-color: red;}

      .inactive {
        background-color: #fff;
        border: 1px solid red;
      }

    </style>
  </head>

  <body>

    <main id="automata"></main>

    <script>

      const automata = document.getElementById('automata');

      let row = {
        create: function() {
          let row = document.createElement('div');
          automata.appendChild(row);
          row.id = 'r' + (automata.children.length - 1);
          row.classList.add('row');
        }
      }

      let cells = {
        grow: function(numCells) {
          let row = document.getElementById('r' + (automata.children.length - 1));
          for (let i=0; i<numCells; i++) {
            let cell = document.createElement('div');
            cell.classList.add('cell');
            cell.id = 'r' + (automata.children.length - 1) + 'c' + i;
            row.appendChild(cell);
          }
        },
        randomizeState: function() {
          function randomBinary() {
            let min = 0;
            let max = 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
          };
          let cells = document.querySelectorAll('#r' + (automata.children.length - 1) + ' > div');
          Array.from(cells).map(cell => cell.classList.add(randomBinary() ? 'active' : 'inactive'));
        },
        previousState: function() {
          let previousCells = document.querySelectorAll('#r' + (automata.children.length - 2) + ' > div');

          for (let i=0; i<previousCells.length; i++) {
            let self = previousCells[i];
            let neighborLeft = previousCells[i - 1] || previousCells[previousCells.length - 1];
            let neighborRight = previousCells[i + 1] || previousCells[0];

            console.log('cell', previousCells[i], 'score', cells.neiborhoodScore(neighborLeft, self, neighborRight));
            // console.log('is active', cells.isActive(self), self);
            // console.log('neighborLeft', neighborLeft)
            // console.log('neighborRight', neighborRight)
          }
        },
        isActive: function(cell) {
          return cell.classList.contains('active');
        },
        neiborhoodScore: function(left, self, right) {
          let score = (cells.isActive(left) ? '1' : '0')
            + (cells.isActive(self) ? '1' : '0')
            + (cells.isActive(right) ? '1' : '0');
          return score;
        },
        ruleSets: {
          90: {
            '111': 'inactive',
            '110': 'active',
            '101': 'inactive',
            '100': 'active',
            '011': 'active',
            '010': 'inactive',
            '001': 'active',
            '000': 'inactive'
          }
        }
      }

      let begin = function() {
        row.create();
        cells.grow(41);
        cells.randomizeState();
      }

      let addRow = function() {
        row.create();
        cells.grow(41);
        cells.previousState();
      }

      begin();
      addRow();
      // newRow.growCells(41);
      // console.log(typeof(newRow.growCells()))
      // console.log('newRow.create()', newRow.create());

      /*
        REFERENCES:
        - Child selectors, https://developer.mozilla.org/en-US/docs/Web/CSS/Child_selectors
        - Node.cloneNode(), https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode
        - Array.from(), https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from
        - Math.random(), https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random#Getting_a_random_integer_between_two_values_inclusive
        ParentNode.children(), https://developer.mozilla.org/en-US/docs/Web/API/ParentNode/children
        - getElementById(), https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById
        - Node.insertBefore(), https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore
        - Node.firstChild, https://developer.mozilla.org/en-US/docs/Web/API/Node/firstChild
        - NodeList.forEach(), https://developer.mozilla.org/en-US/docs/Web/API/NodeList/forEach
        - #Objects and properties, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Working_with_Objects#Objects_and_properties

      */

    </script>

  </body>

</html>
