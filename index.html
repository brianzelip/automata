<!DOCTYPE html>
<html lang="en-US">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="stylesheet" href="https://npmcdn.com/basscss@7.1.1/css/basscss.min.css">
    <title>automata, take 1</title>
    <meta name="description" content="">
    <meta name="author" content="Brian Zelip">
    <meta name="keywords" content="">
    <style>

      #automata {
        margin: 0 .5px;
      }

      .row {
        line-height: .5;
      }

      .cell {
        height: 10px;
        width: 10px;
        display: inline-block;
        /*border-radius: 50%;*/
        box-sizing: border-box;
      }

      .inactive { background-color: red;}

      .active {
        background-color: #fff;
        border: 1px solid red;
      }

    </style>
  </head>

  <body>

    <main id="automata"></main>

    <script>

      const automata = document.getElementById('automata');
      const vw = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
      const vh = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);

      let rows = {
        create: function() {
          let row = document.createElement('div');
          automata.appendChild(row);
          row.id = 'r' + (automata.children.length - 1);
          row.classList.add('row');
        },
        numRowsPerViewport: (vh / 10)
      }

      let cells = {
        numCellsPerRow: (vw/10) - 1,
        grow: function() {
          let row = document.getElementById('r' + (automata.children.length - 1));
          for (let i=0; i<cells.numCellsPerRow; i++) {
            let cell = document.createElement('div');
            cell.classList.add('cell');
            cell.id = 'r' + (automata.children.length - 1) + 'c' + i;
            row.appendChild(cell);
          }
        },
        godMode: function() {
          function randomBinary() {
            let min = 0;
            let max = 1;
            return Math.floor(Math.random() * (max - min + 1)) + min;
          };
          let cells = document.querySelectorAll('#r' + (automata.children.length - 1) + ' > div');
          Array.from(cells).map(cell => cell.classList.add(randomBinary() ? 'active' : 'inactive'));
        },
        natureMode: function(ruleSet) {
          let previousCells = document.querySelectorAll('#r' + (automata.children.length - 2) + ' > div');
          let currentCells = document.querySelectorAll('#r' + (automata.children.length - 1) + ' > div');

          for (let i=0; i<currentCells.length; i++) {
            let self = currentCells[i];
            let prevSelf = previousCells[i];
            let prevNeighborLeft = previousCells[i - 1] || previousCells[previousCells.length - 1];
            let prevNeighborRight = previousCells[i + 1] || previousCells[0];

            self.classList.add(ruleSets[ruleSet][cells.neiborhoodScore(prevNeighborLeft, prevSelf, prevNeighborRight)]);
          }
        },
        isActive: function(cell) {
          return cell.classList.contains('active');
        },
        neiborhoodScore: function(prevLeft, prevSelf, prevRight) {
          let score = (cells.isActive(prevLeft) ? '1' : '0')
            + (cells.isActive(prevSelf) ? '1' : '0')
            + (cells.isActive(prevRight) ? '1' : '0');
          return score;
        }
      }

      let ruleSets = {
        1: {
          wolframSolution: [0, 0, 0, 0, 0, 0, 0, 1],
          '111': 'inactive',
          '110': 'inactive',
          '101': 'inactive',
          '100': 'inactive',
          '011': 'inactive',
          '010': 'inactive',
          '001': 'inactive',
          '000': 'active'
        },
        7: {
          wolframSolution: [0, 0, 0, 0, 0, 1, 1, 1],
          '111': 'inactive',
          '110': 'inactive',
          '101': 'inactive',
          '100': 'inactive',
          '011': 'inactive',
          '010': 'active',
          '001': 'active',
          '000': 'active'
        },
        62: {
          wolframSolution: [0, 0, 1, 1, 1, 1, 1, 0],
          '111': 'inactive',
          '110': 'inactive',
          '101': 'active',
          '100': 'active',
          '011': 'active',
          '010': 'active',
          '001': 'active',
          '000': 'inactive'
        },
        90: {
          wolframSolution: [0, 1, 0, 1, 1, 0, 1, 0],
          '111': 'inactive',
          '110': 'active',
          '101': 'inactive',
          '100': 'active',
          '011': 'active',
          '010': 'inactive',
          '001': 'active',
          '000': 'inactive'
        },
        110: {
          wolframSolution: [0, 1, 1, 0, 1, 1, 1, 0],
          '111': 'inactive',
          '110': 'active',
          '101': 'active',
          '100': 'inactive',
          '011': 'active',
          '010': 'active',
          '001': 'active',
          '000': 'inactive'
        }
      }

      let actOfGod = function() {
        rows.create();
        cells.grow();
        cells.godMode();
      }

      let actOfNature = function(ruleSet) {
        for (let i = 1; i < rows.numRowsPerViewport; i++) {
          rows.create();
          cells.grow();
          cells.natureMode(ruleSet);
        }
      }

      actOfGod();
      actOfNature(110);
      // newRow.growCells(41);
      // console.log(typeof(newRow.growCells()))
      // console.log('newRow.create()', newRow.create());

      /*
        REFERENCES:
        - Child selectors, https://developer.mozilla.org/en-US/docs/Web/CSS/Child_selectors
        - Node.cloneNode(), https://developer.mozilla.org/en-US/docs/Web/API/Node/cloneNode
        - Array.from(), https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from
        - Math.random(), https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/random#Getting_a_random_integer_between_two_values_inclusive
        ParentNode.children(), https://developer.mozilla.org/en-US/docs/Web/API/ParentNode/children
        - getElementById(), https://developer.mozilla.org/en-US/docs/Web/API/Document/getElementById
        - Node.insertBefore(), https://developer.mozilla.org/en-US/docs/Web/API/Node/insertBefore
        - Node.firstChild, https://developer.mozilla.org/en-US/docs/Web/API/Node/firstChild
        - NodeList.forEach(), https://developer.mozilla.org/en-US/docs/Web/API/NodeList/forEach
        - #Objects and properties, https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Working_with_Objects#Objects_and_properties
        - Element.classList, https://developer.mozilla.org/en-US/docs/Web/API/Element/classList
        - Viewport width and height in js, http://stackoverflow.com/a/8876069/2145103
        -
      */

    </script>

  </body>

</html>
